<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºç£æ•™è©å½™æ›¿æ›å·¥å…· - V1.4.1 (Bug Fix)</title>
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --success-color: #059669;
            --success-hover: #047857;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --highlight-bg: #fef08a;
            --highlight-text: #854d0e;
            --diff-line-border: #e2e8f0;
        }

        body.dark-mode {
            --primary-color: #6366f1;
            --primary-hover: #818cf8;
            --success-color: #10b981;
            --success-hover: #34d399;
            --bg-color: #111827;
            --card-bg: #1f2937;
            --text-main: #f9fafb;
            --text-sub: #9ca3af;
            --border-color: #374151;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            --highlight-bg: #854d0e;
            --highlight-text: #fefce8;
            --diff-line-border: #4b5563;
        }

        /* åŸºç¤è¨­å®š */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 1200px;
            padding: 30px;
            box-sizing: border-box;
            margin-top: 20px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h1 span.badge {
            font-size: 0.8rem;
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        /* æŒ‰éˆ•èˆ‡äº’å‹• */
        #darkModeToggle {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-main);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        #darkModeToggle:hover { background-color: var(--bg-color); }

        /* ç·¨è¼¯å€åŸŸ Grid */
        .editor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .editor-grid { grid-template-columns: 1fr; }
        }

        .editor-col {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-sub);
        }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        textarea, #highlightDiv {
            width: 100%;
            height: 450px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        /* æ‹–æ›³æ•ˆæœ */
        textarea.drag-over {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            background-color: rgba(79, 70, 229, 0.05);
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        /* é«˜äº®å±¤ */
        #highlightDiv {
            display: none;
            overflow-y: auto;
            white-space: pre-wrap;
            border-color: var(--success-color);
        }

        .highlight-tag {
            background-color: var(--highlight-bg);
            color: var(--highlight-text);
            padding: 0 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .diff-line {
            padding: 6px 0;
            border-bottom: 1px dashed var(--diff-line-border);
        }
        .diff-line:last-child { border-bottom: none; }
        
        .empty-diff {
            text-align: center;
            padding: 40px;
            color: var(--text-sub);
            font-style: italic;
        }

        /* è¦–åœ–åˆ‡æ›æŒ‰éˆ• */
        .view-toggle {
            font-size: 0.8rem;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-sub);
            padding: 4px 10px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .view-toggle:hover {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .view-toggle.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* æ“ä½œå€ */
        .action-bar {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: space-between;
            align-items: center;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button.btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        button.btn:active { transform: scale(0.98); }

        button.btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        button.btn-primary:hover { background-color: var(--primary-hover); }

        button.btn-secondary {
            background-color: white;
            border: 1px solid var(--border-color);
            color: var(--text-main);
        }
        body.dark-mode button.btn-secondary {
            background-color: #374151;
            border-color: #4b5563;
        }
        button.btn-secondary:hover { background-color: var(--bg-color); }

        button.btn-ai {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }
        button.btn-ai:hover { opacity: 0.9; }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--text-sub);
            padding: 10px;
            border-top: 1px dashed var(--border-color);
            display: flex;
            justify-content: space-between;
        }
        
        .status-highlight {
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Toast é€šçŸ¥ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: #323232;
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.95rem;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 2000;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.error { background-color: #ef4444; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>åŸºç£æ•™è©å½™æ›¿æ›å·¥å…· <span class="badge">V1.4.1</span></h1>
        <button id="darkModeToggle">ğŸŒ“ åˆ‡æ›æ¨¡å¼</button>
    </header>

    <div class="editor-grid">
        <div class="editor-col">
            <div class="label-row">
                <label for="inputText">ğŸ“¥ åŸå§‹å­—å¹• (SRT) - å¯æ‹–æ›³æª”æ¡ˆ</label>
            </div>
            <textarea id="inputText" placeholder="è«‹å°‡åŸå§‹ .srt å…§å®¹è²¼åœ¨é€™è£¡ï¼Œæˆ–è€…ç›´æ¥å°‡æª”æ¡ˆæ‹–å…¥..."></textarea>
        </div>

        <div class="editor-col">
            <div class="label-row">
                <label for="outputText">ğŸ“¤ è™•ç†çµæœ</label>
                <button id="toggleViewBtn" class="view-toggle">ğŸ‘ï¸ åƒ…é¡¯ç¤ºå·²ä¿®æ”¹è™•</button>
            </div>
            <textarea id="outputText" placeholder="è™•ç†å¾Œçš„çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡..."></textarea>
            <div id="highlightDiv"></div>
        </div>
    </div>

    <div class="action-bar">
        <div class="btn-group">
            <button id="convertButton" class="btn btn-secondary">ğŸ” ç°¡è½‰ç¹</button>
            <button id="replaceButton" class="btn btn-primary">ğŸš€ åŸ·è¡Œæ›¿æ› & å¤§å¯«</button>
            <button id="removeTimecodesButton" class="btn btn-secondary">âŒ åˆªé™¤æ™‚é–“ç¢¼</button>
        </div>
        
        <div class="btn-group">
            <button id="downloadButton" class="btn btn-secondary">ğŸ’¾ ä¸‹è¼‰æª”æ¡ˆ</button>
            <button id="copyButton" class="btn btn-secondary">ğŸ“‹ å…¨é¸è¤‡è£½</button>
            <button id="aiPromptButton" class="btn btn-ai">âœ¨ è¤‡è£½ AI æ ¡å°æŒ‡ä»¤</button>
        </div>
    </div>

    <div class="status-bar">
        <span id="replaceResult">ç­‰å¾…è™•ç†...</span>
        <span id="replaceCount" class="status-highlight"></span>
    </div>
</div>

<div id="toast" class="toast">è¨Šæ¯æç¤º</div>

<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/cn2t.js"></script>

<script>
    // ==========================================
    //  é…ç½®èˆ‡è®Šæ•¸
    // ==========================================
    const DATA_URL = 'https://raw.githubusercontent.com/Enoooch0921/Srt-Christian-vocabulary-replacement/main/keywords.csv';
    let globalKeywords = {}; 
    let isHighlightMode = false;

    // ==========================================
    //  å·¥å…·å‡½æ•¸ (Helpers)
    // ==========================================

    // HTML è½‰ç¾©
    function escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    // Toast é€šçŸ¥
    function showToast(message, type = 'normal') {
        const toast = document.getElementById('toast');
        toast.innerText = message;
        toast.className = 'toast show';
        
        if (type === 'error') {
            toast.classList.add('error');
        }

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
    // å…¼å®¹èˆŠå‡½æ•¸å
    const showMessage = (msg) => showToast(msg);
    const showError = (msg) => showToast(msg, 'error');

    // ä¸‹è¼‰è³‡æ–™
    function loadData(url, callback) {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                callback(xhr.responseText);
            }
        };
        xhr.open('GET', url, true);
        xhr.send();
    }

    // æ­£å‰‡è½‰ç¾© (ä¸ä¿®æ”¹ Prototype)
    function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // å–®è©é¦–å­—æ¯å¤§å¯«
    function capitalizeWords(text) {
        return text.replace(/\b\w/g, (match) => match.toUpperCase());
    }

    // è§£æ CSV
    function parseCsvData(csvData) {
        const lines = csvData.split('\n');
        const keywords = {};
        lines.forEach(line => {
            const parts = line.split(',');
            if (parts.length >= 2) {
                if (parts.length === 3) {
                    keywords[parts[0].trim()] = [parts[1].trim(), parts[2].trim().split('|')];
                } else {
                    keywords[parts[0].trim()] = parts[1].trim();
                }
            }
        });
        globalKeywords = keywords;
        return keywords;
    }

    // ==========================================
    //  æ ¸å¿ƒé‚è¼¯ (Core Logic)
    // ==========================================

    function replaceText(keywords) {
        const inputArea = document.getElementById('inputText');
        const rawInput = inputArea.value;

        if(!rawInput.trim()) {
            showError("è«‹å…ˆè¼¸å…¥å…§å®¹ï¼");
            return;
        }

        let plainText = rawInput;
        let htmlText = escapeHtml(rawInput); 
        let count = 0;

        // å®šç¾©ä½”ä½ç¬¦ (ä½¿ç”¨ä¸å®¹æ˜“è¢« CSV é—œéµå­—åŒ¹é…åˆ°çš„ç‰¹æ®Šå­—ä¸²)
        const TAG_START = '###HL_START_TAG###';
        const TAG_END = '###HL_END_TAG###';

        for (const key in keywords) {
            const regExp = new RegExp(escapeRegExp(key), 'gi');
            
            // 1. ç´”æ–‡æœ¬è™•ç†
            if (typeof keywords[key] === 'object') {
                const [replacement, context] = keywords[key];
                const matches = plainText.match(regExp);
                if (matches) {
                    const lines = plainText.split('\n');
                    for (let i = 0; i < lines.length; i++) {
                        if (lines[i].match(regExp)) {
                            const start = Math.max(0, i - 1);
                            const end = Math.min(lines.length - 1, i + 1);
                            const contextMatch = context.some(ctxWord => {
                                for (let j = start; j <= end; j++) {
                                    if (lines[j].includes(ctxWord)) return true;
                                }
                                return false;
                            });
                            if (contextMatch) {
                                lines[i] = lines[i].replace(regExp, replacement);
                                count++;
                            }
                        }
                    }
                    plainText = lines.join('\n');
                }
            } else {
                const replacement = keywords[key];
                const matches = plainText.match(regExp);
                if (matches) {
                    count += matches.length;
                    plainText = plainText.replace(regExp, replacement);
                }
            }

            // 2. HTML é«˜äº®æ¨™è¨˜ (ä¿®æ­£é‡é»ï¼šä½¿ç”¨ä½”ä½ç¬¦)
            const target = (typeof keywords[key] === 'object') ? keywords[key][0] : keywords[key];
            
            // é€™è£¡ä¸ç›´æ¥æ’å…¥ <span...>ï¼Œè€Œæ˜¯æ’å…¥ä½”ä½ç¬¦
            htmlText = htmlText.replace(regExp, (match) => {
                return TAG_START + target + TAG_END;
            });
        }

        // è¿´åœˆçµæŸå¾Œï¼Œçµ±ä¸€å°‡ä½”ä½ç¬¦æ›æˆçœŸæ­£çš„ HTML æ¨™ç±¤
        // é€™æ¨£å¯ä»¥é¿å… <span class="..."> è£¡é¢çš„å–®å­—è¢«å¾ŒçºŒçš„é—œéµå­—èª¤å‚·
        htmlText = htmlText.split(TAG_START).join('<span class="highlight-tag">');
        htmlText = htmlText.split(TAG_END).join('</span>');

        plainText = capitalizeWords(plainText);
        
        // --- ä¿®æ”¹æ ¸å¿ƒï¼šéæ¿¾ä¸¦ç”¢ç”Ÿé è¦½ HTML ---
        const allLines = htmlText.split('\n');
        let filteredHtml = allLines
            .filter(line => line.includes('class="highlight-tag"')) // åªå–æœ‰ä¿®æ”¹çš„è¡Œ
            .map(line => `<div class="diff-line">${line}</div>`)    // åŒ…è£æˆ div
            .join('');

        if (filteredHtml.trim() === "") {
            filteredHtml = '<div class="empty-diff">æ²’æœ‰ç™¼ç¾ä»»ä½•éœ€è¦æ›¿æ›çš„å…§å®¹</div>';
        }

        document.getElementById('outputText').value = plainText;
        document.getElementById('highlightDiv').innerHTML = filteredHtml;
        
        // æ›´æ–°ç‹€æ…‹
        document.getElementById('replaceResult').innerText = "âœ… è™•ç†å®Œæˆï¼";
        document.getElementById('replaceCount').innerText = "å…±æ›¿æ› " + count + " å€‹è©å½™";
        
        // å¦‚æœç•¶å‰æ˜¯é è¦½æ¨¡å¼ï¼Œå¼·åˆ¶åˆ·æ–°é¡¯ç¤º
        if(isHighlightMode) {
             document.getElementById('highlightDiv').style.display = 'block';
             document.getElementById('outputText').style.display = 'none';
        }
        
        showToast("æ›¿æ›å®Œæˆï¼å…± " + count + " è™•ä¿®æ”¹");
    }

    function removeTimecode() {
        const outputText = document.getElementById('outputText').value;
        if(!outputText) { showError("æ²’æœ‰å…§å®¹å¯ä»¥è™•ç†"); return; }
        
        const lines = outputText.split('\n');
        const newText = [];
        const timecodePattern = /^\d{2}:\d{2}:\d{2},\d{3} --> \d{2}:\d{2}:\d{2},\d{3}$/;
        let hasTimecodes = false;

        for (let i = 0; i < lines.length; i++) {
            // æª¢æŸ¥æ˜¯å¦ç‚ºæ™‚é–“ç¢¼
            if (timecodePattern.test(lines[i])) {
                hasTimecodes = true;
                // æ™‚é–“ç¢¼çš„ä¸‹ä¸€è¡Œé€šå¸¸æ˜¯å­—å¹•å…§å®¹ï¼Œä¿ç•™å®ƒ
                if (i + 1 < lines.length && lines[i + 1].trim() !== '') {
                    newText.push(lines[i + 1]);
                }
            } 
            // å¦‚æœä¸æ˜¯æ™‚é–“ç¢¼ï¼Œä¹Ÿä¸æ˜¯ç´”æ•¸å­—åºè™Ÿ(ç°¡å–®åˆ¤æ–·)ï¼Œå¯ä»¥ä¿ç•™
            // é€™è£¡ç°¡å–®é‚è¼¯ï¼šåªé‡å° SRT æ¨™æº–æ ¼å¼ç§»é™¤ (åºè™Ÿ -> æ™‚é–“ç¢¼ -> å…§å®¹)
            // ç”±æ–¼ç”¨æˆ¶éœ€æ±‚ä¸»è¦æ˜¯ä¿ç•™å…§å®¹ï¼Œé€™è£¡é‚è¼¯ç¶­æŒæ‚¨åŸæœ¬çš„ï¼šåƒ…ä¾è³´æ™‚é–“ç¢¼åˆ¤å®š
        }

        if (hasTimecodes) {
            const result = newText.join('\n').trim();
            document.getElementById('outputText').value = result;
            showToast("âœ… æ™‚é–“ç¢¼å·²åˆªé™¤");
        } else {
            showError('æ‰¾ä¸åˆ°æ¨™æº– SRT æ™‚é–“ç¢¼æ ¼å¼');
        }
    }

    // ==========================================
    //  UI äº’å‹•èˆ‡äº‹ä»¶ç¶å®š
    // ==========================================

    // 1. åˆå§‹åŒ–è³‡æ–™è¼‰å…¥
    loadData(DATA_URL, function(csvData) {
        const keywords = parseCsvData(csvData);
        document.getElementById('replaceButton').onclick = () => replaceText(keywords);
    });

    // 2. è¦–åœ–åˆ‡æ›
    document.getElementById('toggleViewBtn').addEventListener('click', function() {
        const txtArea = document.getElementById('outputText');
        const hlDiv = document.getElementById('highlightDiv');
        const btn = document.getElementById('toggleViewBtn');

        if (!isHighlightMode) {
            // åˆ‡æ›åˆ°é è¦½æ¨¡å¼
            if(hlDiv.innerHTML === "") {
                // å¦‚æœé‚„æ²’åŸ·è¡Œéæ›¿æ›ï¼Œå…ˆæç¤º
                showToast("è«‹å…ˆåŸ·è¡Œæ›¿æ›æ‰èƒ½é è¦½", "error");
                return;
            }
            txtArea.style.display = 'none';
            hlDiv.style.display = 'block';
            btn.classList.add('active');
            btn.innerText = "âœï¸ è¿”å›ç·¨è¼¯æ¨¡å¼";
        } else {
            // åˆ‡æ›å›ç·¨è¼¯æ¨¡å¼
            txtArea.style.display = 'block';
            hlDiv.style.display = 'none';
            btn.classList.remove('active');
            btn.innerText = "ğŸ‘ï¸ åƒ…é¡¯ç¤ºå·²ä¿®æ”¹è™•";
        }
        isHighlightMode = !isHighlightMode;
    });

    // 3. è¤‡è£½åŠŸèƒ½
    document.getElementById('copyButton').onclick = function() {
        const outputText = document.getElementById('outputText');
        if(isHighlightMode) document.getElementById('toggleViewBtn').click(); // å¼·åˆ¶åˆ‡å›æ–‡å­—æ¨¡å¼ä»¥è¤‡è£½
        
        if(!outputText.value) { showError("æ²’æœ‰å…§å®¹å¯ä»¥è¤‡è£½"); return; }

        outputText.select();
        document.execCommand('copy');
        showToast('ğŸ“‹ å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
    };

    // 4. ä¸‹è¼‰åŠŸèƒ½ (æ–°å¢)
    document.getElementById('downloadButton').addEventListener('click', function() {
        const text = document.getElementById('outputText').value;
        if (!text) { showError("æ²’æœ‰å…§å®¹å¯ä¸‹è¼‰"); return; }
        
        const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "processed_subtitle.srt";
        a.click();
        URL.revokeObjectURL(a.href);
        showToast("ğŸ’¾ æª”æ¡ˆä¸‹è¼‰é–‹å§‹");
    });

    // 5. æ‹–æ›³ä¸Šå‚³åŠŸèƒ½ (æ–°å¢)
    const dropZone = document.getElementById('inputText');
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
    });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        const file = e.dataTransfer.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('inputText').value = e.target.result;
                showToast("æª”æ¡ˆè¼‰å…¥æˆåŠŸï¼");
            };
            reader.readAsText(file);
        }
    });

    // 6. å…¶ä»–æŒ‰éˆ•
    document.getElementById('removeTimecodesButton').onclick = removeTimecode;

    // OpenCC ç°¡è½‰ç¹
    const converter = OpenCC.Converter({ from: "cn", to: "tw" });
    document.getElementById('convertButton').addEventListener('click', function() {
        const inputText = document.getElementById('inputText').value;
        if(!inputText) { showError("è«‹å…ˆè¼¸å…¥ç°¡é«”å…§å®¹"); return; }
        const convertedText = converter(inputText);
        document.getElementById('inputText').value = convertedText;
        showToast('ğŸ” ç¹é«”è½‰æ›æˆåŠŸï¼');
    });

    // æ·±è‰²æ¨¡å¼
    document.getElementById('darkModeToggle').addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
    });

    // AI Prompt ç”Ÿæˆ
    document.getElementById('aiPromptButton').addEventListener('click', function() {
        const outputText = document.getElementById('outputText').value;
        if (!outputText) { showError('è¼¸å‡ºæ¡†æ²’æœ‰å…§å®¹ï¼Œç„¡æ³•ç”ŸæˆæŒ‡ä»¤'); return; }
        
        const prompt = `è«‹å¹«æˆ‘æ ¡å°ä»¥ä¸‹çš„ SRT å­—å¹•ã€‚

ã€å‰ç½®èªªæ˜ã€‘
é€™ä»½å­—å¹•å·²ç¶“éã€ŒåŸºç£æ•™è¡“èªã€çš„è‡ªå‹•æ›¿æ›ç¨‹å¼è™•ç†ï¼Œä½†å…§å®¹ä¾†æºç‚ºèªéŸ³è½‰æ–‡å­—ï¼Œä»å¯èƒ½å­˜åœ¨ç¶“æ–‡ã€äººåèˆ‡å°ˆæœ‰åè©çš„èª¤åˆ¤ï¼Œä»¥åŠä»£åè©èˆ‡æ•¬ç¨±æ··ç”¨ã€‚

ã€ä½ çš„è§’è‰²ã€‘
ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰ä¸­æ–‡å£èªå­—å¹•ã€æ•™æœƒè¬›é“èˆ‡è¦‹è­‰å½±ç‰‡å…§å®¹çš„å­—å¹•æ ¡å°å“¡ï¼Œäº†è§£è–ç¶“å¸¸è¦‹ç”¨èªã€ç¥å­¸èªå¢ƒèˆ‡äººåã€‚

ã€æ ¡å°åŸå‰‡èˆ‡ä»»å‹™è¦æ±‚ã€‘
1. ã€çµ•å°ç¦æ­¢ã€‘
   - ä¸å¾—ä¿®æ”¹ä»»ä½•åºè™Ÿèˆ‡æ™‚é–“ç¢¼ï¼ˆTimecodeï¼‰ã€‚

2. ã€éŒ¯åˆ¥å­—èˆ‡èªéŸ³èª¤åˆ¤ä¿®æ­£ã€‘
   - ä¿®æ­£åŒéŸ³ç•°å­—ã€æ˜é¡¯éŒ¯å­—èˆ‡èªéŸ³è½‰æ–‡å­—é€ æˆçš„ä¸åˆç†è©å½™ã€‚
   - è‹¥å‡ºç¾ç–‘ä¼¼è–ç¶“ç¶“æ–‡ï¼Œè«‹ä¾å¸¸è¦‹ä¸­æ–‡è–ç¶“ç‰ˆæœ¬ï¼ˆå¦‚å’Œåˆæœ¬ï¼‰ä¿®æ­£æ˜é¡¯éŒ¯èª¤ï¼Œä½†ä¸å¾—æ”¹è®Šç¶“æ–‡åŸæ„ã€‚
   - è‹¥å‡ºç¾äººåï¼Œè«‹åˆç†åˆ¤æ–·æ˜¯å¦ç‚ºå¸¸è¦‹äººç‰©ï¼ˆå¦‚è–ç¶“äººç‰©ã€è¬›å“¡ã€ä¿¡ä»°ç›¸é—œäººå£«ï¼‰ï¼Œåƒ…åœ¨é«˜åº¦ç¢ºå®šæ™‚é€²è¡Œæ ¡æ­£ï¼Œé¿å…çŒœæ¸¬æ€§ä¿®æ”¹ã€‚

3. ã€ä»£åè©ï¼æ•¬ç¨±ä¸€è‡´æ€§ï¼ˆé‡è¦ï¼‰ã€‘
   - è«‡åˆ°ä¸Šå¸ï¼è€¶ç©Œï¼è–éˆæ™‚ï¼Œå„ªå…ˆä½¿ç”¨ã€Œç¥¢ã€ã€Œç¥‚ã€ï¼Œä¸¦ä¿æŒå‰å¾Œä¸€è‡´ã€‚
   - è«‡åˆ°ä¸€èˆ¬äººæ™‚ï¼Œä½¿ç”¨ã€Œä½ ï¼ä»–ï¼å¥¹ã€ï¼Œä¸¦ä¾ä¸Šä¸‹æ–‡åˆ¤æ–·æ€§åˆ¥èˆ‡å°è±¡ã€‚
   - è«‡åˆ°å‹•ç‰©æˆ–éäººç‰©äº‹ç‰©æ™‚ä½¿ç”¨ã€Œç‰ ï¼å®ƒã€ã€‚
   - è«‡åˆ°é­”é¬¼ï¼æ’’ä½†ï¼é‚ªéˆç­‰ï¼Œè‹¥ä¸Šä¸‹æ–‡æ˜ç¢ºæŒ‡å‘å±¬éˆå­˜åœ¨ä¸”ä¸é©åˆç”¨ã€Œç‰ ã€é€ æˆèªæ„Ÿåå‹•ç‰©ï¼Œå¯æ”¹ç”¨ã€Œä»–ã€æˆ–ã€Œç‰ ã€æ“‡ä¸€ï¼Œä½†éœ€ä¾æ•´æ®µèªå¢ƒçµ±ä¸€ï¼ˆåŒä¸€æ®µè½ä¸è¦ä¾†å›åˆ‡æ›ï¼‰ã€‚
   - è‹¥ä¸Šä¸‹æ–‡ä¸è¶³ä»¥åˆ¤å®šï¼ˆä¾‹å¦‚åªå‡ºç¾ä¸€å¥ã€Œä»–èªªã€è€Œæ²’æœ‰å‰å¾Œç·šç´¢ï¼‰ï¼Œè«‹ä¸è¦å¼·è¡Œæ”¹å‹•ï¼Œç¶­æŒåŸæ–‡ä¸¦åœ¨å°ç…§è¡¨è¨»è¨˜ã€Œä¸ç¢ºå®šï¼Œä¿ç•™ã€ã€‚

4. ã€èªå¥ä¿®é£¾ã€‘
   - åœ¨ä¸æ”¹è®ŠåŸæ„ã€ä¸åŠ å…¥æ–°è³‡è¨Šçš„å‰æä¸‹ï¼Œä½¿èªå¥æ›´å£èªè‡ªç„¶ã€ç¬¦åˆå­—å¹•é–±è®€ç¯€å¥ã€‚
   - è«‹é¿å…é‡å¯«å¥å‹æˆ–é€²è¡Œè¬›ç« å¼æ½¤ç¨¿ï¼Œä½ çš„è§’è‰²æ˜¯æ ¡å°ï¼Œè€Œéæ”¹å¯«ã€‚

5. ã€è¼¸å‡ºæ ¼å¼ï¼ˆé‡è¦ï¼‰ã€‘
   - ä¿®æ”¹å¾Œçš„å®Œæ•´ SRT å…§å®¹ã€å‹™å¿…å®Œæ•´ä¿ç•™æ ¼å¼ï¼Œä¸¦å…¨éƒ¨æ”¾åœ¨ä»£ç¢¼æ¡†ä¸­ã€‘ã€‚
   - æœ€å¾Œè«‹æä¾›ä¸€ä»½ä¿®æ”¹å°ç…§è¡¨ï¼Œæ¸…æ¥šåˆ—å‡ºï¼š
     åŸæ–‡ â†’ ä¿®æ”¹å¾Œ â†’ ä¿®æ”¹åŸå› ï¼ˆå«ï¼šéŒ¯åˆ¥å­—/ç¶“æ–‡æ ¡æ­£/äººåæŸ¥æ ¸/ä»£åè©ä¸€è‡´æ€§/èªå¥é †æš¢ï¼‰ã€‚

ã€SRT å…§å®¹å¦‚ä¸‹ã€‘
${outputText}`;

        navigator.clipboard.writeText(prompt).then(() => {
            showToast('âœ¨ å·²è¤‡è£½ AI æŒ‡ä»¤ï¼è«‹è²¼çµ¦ Gemini');
        }, () => {
            showError('è¤‡è£½å¤±æ•—');
        });
    });

</script>
</body>
</html>
